<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <meta name="author" content="TransLink Forecasting">
  <link rel="canonical" href="https://translinkforecasting.github.io/rtmdoc/data_analysis/">
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>Model Data Analysis - RTM</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" />

  <link rel="stylesheet" href="../css/theme.css" />
  <link rel="stylesheet" href="../css/theme_extra.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" />
  <link href="../css/extra.css" rel="stylesheet" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "Model Data Analysis";
    var mkdocs_page_input_path = "data_analysis.md";
    var mkdocs_page_url = "/rtmdoc/data_analysis/";
  </script>
  
  <script src="../js/jquery-2.1.1.min.js" defer></script>
  <script src="../js/modernizr-2.8.3.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/yaml.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/rust.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
  <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

      ga('create', '', 'auto');
      ga('send', 'pageview');
  </script>
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> RTM</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <p class="caption"><span class="caption-text">User Guide</span></p>
                <ul class="current">
                    <li class="toctree-l1"><a class="reference internal" href="../workflow/">Model Workflow</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../adv_inputs/">Advanced Inputs</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../data_outputs/">Model Data Output</a>
                    </li>
                    <li class="toctree-l1 current"><a class="reference internal current" href="./">Model Data Analysis</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#python-libraries-and-the-emme-python">Python libraries and the EMME python</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#python-util">Python + util</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#data-extraction-using-variables-of-interest-tool">Data extraction using variables of interest tool</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#setting-up-the-spreadsheet">Setting up the spreadsheet</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#running-the-modeller-tool">Running the Modeller Tool</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#viewing-results">Viewing results</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#post-processing-tools">Post-processing tools</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#auto-select-link-tool">Auto Select Link tool</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#transit-select-linkline-tool">Transit Select link/line tool</a>
    </li>
        </ul>
    </li>
    </ul>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../data_generate/">Custom Data Generation</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Developer Guide</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../dev_getting_started/">Getting Started</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../coding_standard/">Coding Standard</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">References</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../reports/">Reports</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../naming_conventions/">Naming Conventions</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../data_assumptions/">Data and Assumptions</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">About</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../about/contributing/">Contributing</a>
                    </li>
                </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">RTM</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
        
          <li>User Guide &raquo;</li>
        
      
    
    <li>Model Data Analysis</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="model-data-analysis">Model Data Analysis<a class="headerlink" href="#model-data-analysis" title="Permanent link">&para;</a></h1>
<h2 id="python-libraries-and-the-emme-python">Python libraries and the EMME python<a class="headerlink" href="#python-libraries-and-the-emme-python" title="Permanent link">&para;</a></h2>
<p>In general the RTM uses the default python libraries installed with the EMME python.  In some cases this means foregoing features that have been recently introduced or having code that is not compatible with python installations outside EMME.  However, it ensures that the RTM will run without further configuration providing the user has installed the correct version of EMME.  </p>
<h2 id="python-util">Python + util<a class="headerlink" href="#python-util" title="Permanent link">&para;</a></h2>
<p>The RTM scripting employs a utility toolbox that creates functions for repeated operations.  It is worth familiarizing yourself with the functions here as they are often employed outside the RTM run itself to post-process data.</p>
<p>For example, util can be used to create a pandas dataframe for full matrices and append RTM matrices to it for further analysis or plotting in python.  </p>
<pre><code class="language-Python">    import inro.modeller as _m

    util = _m.Modeller().tool(&quot;translink.util&quot;)

    eb = _m.Modeller().emmebank

    df = util.get_pd_ij_df(eb) # create a longform pandas dataframe for full matrices

    # add columns for light and heavy truck OD tables to the data frame
    df['amLGVDemand'] = util.get_matrix_numpy(eb, &quot;mfLGVAM&quot;).flatten() 
    df['amHGVDemand'] = util.get_matrix_numpy(eb, &quot;mfHGVAM&quot;).flatten()
</code></pre>
<p>Which yields the following results:</p>
<p><img alt="Screenshot" src="../img/data_analysis/util_python_00_output_results.png" /></p>
<p>In the above example matrix names or numbers can be used to access the data in <code>util.get_matrix_numpy()</code>. </p>
<h2 id="data-extraction-using-variables-of-interest-tool">Data extraction using variables of interest tool<a class="headerlink" href="#data-extraction-using-variables-of-interest-tool" title="Permanent link">&para;</a></h2>
<p>In this example we use a spreadsheet to build a sqlite database.  This tools allows the user to create tables and fields within a table using EMME matrix calculations.  The <code>Variables_of_Interest.xlsx</code> spreadsheet is located in the <code>RTM/Scripts/Phase3Analytics</code> folder. </p>
<h4 id="setting-up-the-spreadsheet">Setting up the spreadsheet<a class="headerlink" href="#setting-up-the-spreadsheet" title="Permanent link">&para;</a></h4>
<p>The <code>Datamap</code> tab describes what each field does in the <code>Sheet1</code> tab.  The <code>Sheet1</code> tab is used to build the database.  </p>
<p><img alt="Screenshot" src="../img/data_analysis/extractiontool_00_ssDatamap.png" /></p>
<p>A simple matrix calculation can be used to extract data.  Entering the following in <code>Sheet1</code> will create a table in the output sqlite database with AM demand for light and heavy goods vehicles equivalent to the pandas data frame example above:</p>
<p><img alt="Screenshot" src="../img/data_analysis/extractiontool_00_lgv_hgv_example.png" /></p>
<p>In addition to simple data extraction, new data can be generated based on RTM outputs using EMME matrix calculator expressions.  For example, we can create a matrix of the minimum time on transit between all zones considering both the bus and rail modes.  Note that we can reference EMME matrices by name or number.  </p>
<p><img alt="Screenshot" src="../img/data_analysis/extractiontool_00_min_transit_time.png" /></p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>All <code>Attributes</code> (fields) associated with the same <code>Category</code> (table) must be of the same dimension.  For example, full matrices (MF) and vectors (MO/MD) must be placed in separate tables.</p>
</div>
<h4 id="running-the-modeller-tool">Running the Modeller Tool<a class="headerlink" href="#running-the-modeller-tool" title="Permanent link">&para;</a></h4>
<p>Once you have specified  the data you wish to output in in <code>Sheet1</code>, the modeller tool <code>Variables of Interest Extraction</code> located in the Phase3Analytics Toolbox can be run to produce the outputs.</p>
<p><img alt="Screenshot" src="../img/data_analysis/extractiontool_01_toolbox.png" /></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This tool requires the installation of one additional python library.  Installation instructions can be found in the tool documentation at <code>RTM/Documentation/ToolDoc_VariablesOfInterest.pdf</code>.  </p>
</div>
<p>To create the database with your specified tables and fields simply run the tool with the appropriate sheet name in the field.  If you have not changed the name from <code>Sheet1</code> there is nothing to update and you can simply run the tool.  </p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The name <code>Sheet1</code> can be changed to any Excel allowable name.  The chosen name needs to be passed to the tool either in the modeller interface or the function call.    </p>
</div>
<h4 id="viewing-results">Viewing results<a class="headerlink" href="#viewing-results" title="Permanent link">&para;</a></h4>
<p>The requested results will be output to a sqlite database named <code>Variables_of_Interest_Results.db</code>.  The output can be viewed in the same manner as the <code>trip_summaries.db</code> and <code>rtm.db</code> discussed <a href="../data_outputs/#using-the-rtm-and-trip-summaries-databases">here</a></p>
<h2 id="post-processing-tools">Post-processing tools<a class="headerlink" href="#post-processing-tools" title="Permanent link">&para;</a></h2>
<p>RTM provides several standard tools to help users quickly analyze the transportation results after the model run. The common-use pro-processing tools are select link analysis for traffic and select transit analysis for public transit. These two tools are also located in Phase3Analytics Toolbox.</p>
<p><img alt="toolbox" src="../img/data_analysis/selectlinktool_00.png" /></p>
<h3 id="auto-select-link-tool">Auto Select Link tool<a class="headerlink" href="#auto-select-link-tool" title="Permanent link">&para;</a></h3>
<p>The auto select link tool is for analyzing the auto traffic on a select link. The tool provides a simple capability to let user perform a quick select assignment. Set @selectlink=1 to select the link that to be evaluated.</p>
<p><img alt="auto select" src="../img/data_analysis/selectlinktool_01_AutoUI.png" width="75%" /></p>
<h3 id="transit-select-linkline-tool">Transit Select link/line tool<a class="headerlink" href="#transit-select-linkline-tool" title="Permanent link">&para;</a></h3>
<p>The transit select tool provides larger capability to perform more complicated post analysis. It executes the transit assignment based on the select link/ line. Upon the request, the outputs can be:</p>
<ul>
<li>transit segment volumes, boardings, alightings for select transit link/line</li>
<li>link auxiliary transit volume for select walk link</li>
<li>matrices by transit sub-mode</li>
</ul>
<p><img alt="transit select" src="../img/data_analysis/selectlinktool_02_TransitUI.png" width="70%" /></p>
<p><strong><em>Before using the tool</em></strong></p>
<p>There are some procedures needs to be done prior to applying the select transit tool:
- Ensure the databank dimension has enough room for additional extra attributes. The recommended number is 2,500,000
- Strategies generated by extended transit assignments. (Finish full model run or transit assignment) 
- Recommend copy AM, MD, and PM scenario to prevent from overwriting the original scenario<br />
- Create the extra attribute(s) and set the appropriate value in all three scenarios (following the below instruction)</p>
<p><strong><em>After using the tool</em></strong></p>
<p>The tool performs post-analyses on paths extracted from strategies generated by extended transit assignments, and it creates:
1. new matrices and save the O-D results:</p>
<table>
<thead>
<tr>
<th>ID</th>
<th>Name</th>
<th>Descritption</th>
</tr>
</thead>
<tbody>
<tr>
<td>mf110</td>
<td>AMBUSsline</td>
<td>AM Bus Select transit O-D</td>
</tr>
<tr>
<td>mf111</td>
<td>AMRALsline</td>
<td>AM Rail Select transit O-D</td>
</tr>
<tr>
<td>mf112</td>
<td>AMWCEsline</td>
<td>AM WCE Select transit O-D</td>
</tr>
<tr>
<td>mf113</td>
<td>AMTOTsline</td>
<td>AM TOT Select transit O-D</td>
</tr>
<tr>
<td>mf130</td>
<td>MDBUSsline</td>
<td>MD Bus Select transit O-D</td>
</tr>
<tr>
<td>mf131</td>
<td>MDRALsline</td>
<td>MD Rail Select transit O-D</td>
</tr>
<tr>
<td>mf132</td>
<td>MDWCEsline</td>
<td>MD WCE Select transit O-D</td>
</tr>
<tr>
<td>mf133</td>
<td>MDTOTsline</td>
<td>MD TOT Select transit O-D</td>
</tr>
<tr>
<td>mf150</td>
<td>PMBUSsline</td>
<td>PM Bus Select transit O-D</td>
</tr>
<tr>
<td>mf151</td>
<td>PMRALsline</td>
<td>PM Rail Select transit O-D</td>
</tr>
<tr>
<td>mf152</td>
<td>PMWCEsline</td>
<td>PM WCE Select transit O-D</td>
</tr>
<tr>
<td>mf153</td>
<td>PMTOTsline</td>
<td>PM TOT Select transit O-D</td>
</tr>
</tbody>
</table>
<p>2.new extra attributes and save network results:</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Descritption</th>
<th>Name</th>
<th>Descritption</th>
</tr>
</thead>
<tbody>
<tr>
<td>@voltr_bussline</td>
<td>Transit Volume BUS</td>
<td>@board_bussline</td>
<td>Boardings BUS</td>
</tr>
<tr>
<td>@voltr_ralsline</td>
<td>Transit Volume RAL</td>
<td>@board_ralsline</td>
<td>Boardings RAL</td>
</tr>
<tr>
<td>@voltr_wcesline</td>
<td>Transit Volume WCE</td>
<td>@board_wcesline</td>
<td>Boardings WCE</td>
</tr>
<tr>
<td>@voltr_totsline</td>
<td>Transit Volume TOT</td>
<td>@board_totsline</td>
<td>Boardings TOT</td>
</tr>
<tr>
<td>@volax_bussline</td>
<td>Aux Transit Volume BUS</td>
<td>@alight_bussline</td>
<td>Alightings BUS</td>
</tr>
<tr>
<td>@volax_ralsline</td>
<td>Aux Transit Volume RAL</td>
<td>@alight_ralsline</td>
<td>Alightings RAL</td>
</tr>
<tr>
<td>@volax_wcesline</td>
<td>Aux Transit Volume WCE</td>
<td>@alight_wcesline</td>
<td>Alightings WCE</td>
</tr>
<tr>
<td>@volax_totsline</td>
<td>Aux Transit Volume TOT</td>
<td>@alight_totsline</td>
<td>Alightings TOT</td>
</tr>
</tbody>
</table>
<p>3.Aggregate O-D result matrices and export to CSV: 
<strong><Project folder>\rtm\RTM\<databank>\Outputs\transit_sline_gy.csv)</strong></p>
<p><strong><em>transit link/line selection</em></strong></p>
<p>The transit link/line can be selected by setting up the trip components. There are multiple ways to select the trip component. One or more trip components can be taken into account:</p>
<p><img alt="transit selection" src="../img/data_analysis/selectlinktool_03_Selection.png" width="70%" /></p>
<ul>
<li>For in-vehicle trip component, the selections can be link (@selectsegment), transit line (@selectline), or segment (@selectlink). </li>
<li>Check the box if the trip component is an auxiliary transit link</li>
<li>For boarding or alighting trip component, the selections is node attribute(@selectinboanode,@selectfialinode @selecttrboanode @selecttralinode ). Check one box from the node component upon the purpose. </li>
</ul>
<p><strong><em>Examples</em></strong></p>
<p>These are some examples related to trip component selection, and path selection threshold.</p>
<p>Case 1: The people who are in-vehicle in segment A 
<img alt="example1" src="../img/data_analysis/selectlinktool_04_Example_case1.png" />
Case 2: The people who in-vehicle in segment A <strong>OR</strong> walk on link B
<img alt="example2" src="../img/data_analysis/selectlinktool_04_Example_case2.png" />
Case 3: The people who in-vehicle in segment A <strong>AND</strong> walk on link B
<img alt="example3" src="../img/data_analysis/selectlinktool_04_Example_case3.png" />
Case 4: The people who in-vehicle in segment A <strong>AND</strong> walk on link B <strong>AND</strong> transfer boarding at node C
<img alt="example4" src="../img/data_analysis/selectlinktool_04_Example_case4.png" />
Case 5: The people who take any segment D of a transit line
<img alt="example5" src="../img/data_analysis/selectlinktool_04_Example_case5.png" />
Case 6: The people who initially board at node C <strong>AND</strong> finally alight at node E
<img alt="example6" src="../img/data_analysis/selectlinktool_04_Example_case6.png" /></p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../data_generate/" class="btn btn-neutral float-right" title="Custom Data Generation">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../data_outputs/" class="btn btn-neutral" title="Model Data Output"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
      <p>Copyright &copy; 2020 TransLink Forecasting</p>
    
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/TransLinkForecasting/rtmdoc" class="fa fa-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="../data_outputs/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../data_generate/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
