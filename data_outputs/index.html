<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <meta name="author" content="TransLink Forecasting">
  <link rel="canonical" href="https://translinkforecasting.github.io/rtmdoc/data_outputs/">
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>Model Data Output - RTM</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" />

  <link rel="stylesheet" href="../css/theme.css" />
  <link rel="stylesheet" href="../css/theme_extra.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" />
  <link href="../css/extra.css" rel="stylesheet" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "Model Data Output";
    var mkdocs_page_input_path = "data_outputs.md";
    var mkdocs_page_url = "/rtmdoc/data_outputs/";
  </script>
  
  <script src="../js/jquery-2.1.1.min.js" defer></script>
  <script src="../js/modernizr-2.8.3.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/yaml.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/rust.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
  <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

      ga('create', '', 'auto');
      ga('send', 'pageview');
  </script>
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> RTM</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <p class="caption"><span class="caption-text">User Guide</span></p>
                <ul class="current">
                    <li class="toctree-l1"><a class="reference internal" href="../workflow/">Model Workflow</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../adv_inputs/">Advanced Inputs</a>
                    </li>
                    <li class="toctree-l1 current"><a class="reference internal current" href="./">Model Data Output</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#exporting-full-matrix-directory">Exporting full matrix directory</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#searching-for-matrices">Searching for matrices</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#using-the-rtm-and-trip-summaries-databases">Using the rtm and trip summaries databases</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#database-queries">Database queries</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#query-example-traffic-zone-with-highest-employment-density">Query example: Traffic zone with highest employment density</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#query-example-total-vehicle-kilometers-vkt-by-peak-period-and-origin-gy">Query example: Total vehicle-kilometers (VKT) by peak period and origin GY</a>
    </li>
        </ul>
    </li>
        </ul>
    </li>
    </ul>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../data_analysis/">Model Data Analysis</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../data_generate/">Custom Data Generation</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Developer Guide</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../dev_getting_started/">Getting Started</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../coding_standard/">Coding Standard</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">References</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../reports/">Reports</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../naming_conventions/">Naming Conventions</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../data_assumptions/">Data and Assumptions</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">About</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../about/contributing/">Contributing</a>
                    </li>
                </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">RTM</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
        
          <li>User Guide &raquo;</li>
        
      
    
    <li>Model Data Output</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="model-data-output">Model Data Output<a class="headerlink" href="#model-data-output" title="Permanent link">&para;</a></h1>
<h2 id="exporting-full-matrix-directory">Exporting full matrix directory<a class="headerlink" href="#exporting-full-matrix-directory" title="Permanent link">&para;</a></h2>
<p>The RTM produces a lot of data for each run, there are more than 1,000 full matrices at the end of a run.  It's sometimes difficult to know what data is available afterwards.  EMME desktop provides a full matrix directory, but it is not directly searchable. However if we open the worksheet located here:</p>
<p><code>Worksheets/Tables/EMME Standard - GENERAL/General/Matrices/Matrix directory - Full matrices (mf)</code></p>
<p><img alt="Screenshot" src="../img/data_output/data_extraction_mf_worksheet.png" /></p>
<p>Clicking on the icon that looks like a database table opens the worksheet as a datatable.  A datatable is effectively a sqlite database table.  </p>
<p><img alt="Screenshot" src="../img/data_output/data_extraction_datatablebutton.png" /></p>
<p>Click the <code>save as</code> button </p>
<p><img alt="Screenshot" src="../img/data_output/data_extraction_datatablesaveas.png" /></p>
<p>Removing spaces in the name simplifies later querying.</p>
<p><img alt="Screenshot" src="../img/data_output/data_extraction_datatableremovespace.png" /></p>
<p>The matrix directory will be saved at the project level in the <code>RTM\data_tables.db</code> sqlite database, which we will query in the next section.  </p>
<h2 id="searching-for-matrices">Searching for matrices<a class="headerlink" href="#searching-for-matrices" title="Permanent link">&para;</a></h2>
<p>Now that we have the full matrix directory saved at the project level in the <code>RTM\data_tables.db</code> sqlite database, we can use SQL to search for matrices that are of interest.  Although there are a number of ways to access the database we recommend a sqlite viewer such as <a href="https://sqlitestudio.pl/index.rvt?act=download">SQLite Studio</a></p>
<p>Suppose we are interested in commute trips and want to find home-based work production attraction (PA) matrices.  We can open the database in the sqlite viewer and execute the following query</p>
<pre><code class="language-SQL">SELECT 
     Matrix
    ,[Name]
    ,[Description]

FROM Fullmatrixdirectory

WHERE 1=1
    and UPPER([Name]) LIKE '%HBW%'
    or  UPPER([Name]) LIKE '%WORK%'
    or  UPPER([Description]) LIKE '%HBW%'
    or  UPPER([Description]) LIKE '%WORK%'

</code></pre>
<p>Which yields the following results</p>
<p><img alt="Screenshot" src="../img/data_output/mf_query_longresults.png" /></p>
<p>We get 164 records, but can see the matrices we want highlighted in the red box.  Changing the <code>WHERE</code> clause returns only the results we want:</p>
<pre><code class="language-SQL">SELECT 
     Matrix
    ,[Name]
    ,[Description]

FROM Fullmatrixdirectory

WHERE 1=1
    and UPPER([Name]) LIKE 'HBWP-A%'
</code></pre>
<p>Now we get only 9 results, 3 income categories by 3 auto ownership levels</p>
<p><img alt="Screenshot" src="../img/data_output/mf_query_shortresults.png" /></p>
<p>Changing the <code>WHERE</code> clause as follows let's us see the PA tables for all home-based purposes</p>
<pre><code class="language-SQL">SELECT 
     Matrix
    ,[Name]
    ,[Description]

FROM Fullmatrixdirectory

WHERE 1=1
    and UPPER([Name]) LIKE 'HB%P-A%'
</code></pre>
<p>Note that we get 55 records.  There are 7 home-based purposes, but home-based university does not have income and auto-ownership distinction so 6 x 9 + 1 = 55.  </p>
<p><img alt="Screenshot" src="../img/data_output/mf_query_hbresults.png" /></p>
<p>Finally, we can add an 'N' to the <code>WHERE</code> clause to see the non-home-based purposes.  </p>
<pre><code class="language-SQL">SELECT 
     Matrix
    ,[Name]
    ,[Description]

FROM Fullmatrixdirectory

WHERE 1=1
    and UPPER([Name]) LIKE 'NH%P-A%'
</code></pre>
<p>And here we get 2 records because there are 2 non-home-based purposes and they do not have income and auto-ownership distinction. </p>
<p><img alt="Screenshot" src="../img/data_output/mf_query_nhresults.png" /></p>
<p>Similar methods can be used to find other data of interest</p>
<h2 id="using-the-rtm-and-trip-summaries-databases">Using the rtm and trip summaries databases<a class="headerlink" href="#using-the-rtm-and-trip-summaries-databases" title="Permanent link">&para;</a></h2>
<p>In addition to the matrices generated by EMME and stored in the databank during full model run, the RTM saves various input and output data related to the model run in two sqlite databases.</p>
<p>The <code>rtm.db</code> database primarily store input data, intermediate values, or high-level model results useful for diagnosing model issues. You can view all the tables within this database with <a href="https://sqlitestudio.pl/index.rvt?act=download">SQLite Studio</a>.</p>
<blockquote>
<p><img alt="Screenshot" src="../img/data_output/databases_1_1.png" /></p>
</blockquote>
<!-- 
NOT INCLUDING FOR NOW... Too much detail?

The following tables contain some key input data from the `rtm.db` database:

* **demographics**: Metro Vancouver growth projections used for the model run
* **dummies**: geographic dummies
* **ensembles**: groups of geographic regions
* **geographics**: geographic characteristics by traffic zones, such as parking rates, car share, and bike score.
* **metadata**: model scenario, year, and alternative definitions
* **parknride**: park and ride lot settings
* **segmentedHouseholds**: household segmentation by traffic zones
* **taz_index**: numbers of all traffic zones
* **timeSlicingFactors**: time slicing factors
* **timeSlicingFactorsGb**: time slicing factors full table

The following tables contain some intermediate values and high-level model results from the `rtm.db` database:

* **accessibilities**: distance-based accessibility measure
* **logsum_accessibilities**: logsum-utility-based accessibility measure
* **densities**: population and employment density
* **transit_adj**: transit bias adjustments
* **TripsBalCts**: 
* **TripsHhPrds**: 
* **TripsTazAtrs**: 
* **TripsTazPrds**:  -->

<p>The <code>trip_summaries.db</code> database contains high-level results reported by GY (large multi-municipal groups for Metro Vancouver) and disaggregate-level results by network link and transit lines.</p>
<blockquote>
<p><img alt="Screenshot" src="../img/data_output/databases_1_2.png" /></p>
</blockquote>
<h3 id="database-queries">Database queries<a class="headerlink" href="#database-queries" title="Permanent link">&para;</a></h3>
<p>SQLite databases are packaged into a single database file, so they are easy to create and share. Like other databases, users can run simple SQL queries to get quick answers about the data. To start writing queries, open query editor in SQLite Studio, then select the correct database to run the query from:</p>
<blockquote>
<p><img alt="Screenshot" src="../img/data_output/database_query_1_1.png" /></p>
<p><img alt="Screenshot" src="../img/data_output/database_query_1_2_1.png" /></p>
</blockquote>
<h4 id="query-example-traffic-zone-with-highest-employment-density">Query example: Traffic zone with highest employment density<a class="headerlink" href="#query-example-traffic-zone-with-highest-employment-density" title="Permanent link">&para;</a></h4>
<p>If you are trying to get the max value from a table, use the max(colname) builtin function.</p>
<pre><code class="language-sql">SELECT max(empdens) FROM densities
</code></pre>
<p>Results of the query would look something like this:</p>
<table>
<thead>
<tr>
<th>max(empdens)</th>
</tr>
</thead>
<tbody>
<tr>
<td>2821.884521484375</td>
</tr>
</tbody>
</table>
<p>If you are trying to get the max value for a certain set of rows, for instance, a certain range from taz, add <code>WHERE</code> statement</p>
<pre><code class="language-sql">SELECT max(empdens) 

FROM densities 

WHERE TAZ1700&gt;=10000 and 
      TAZ1700&lt;20000
</code></pre>
<p>Sample results of query:</p>
<table>
<thead>
<tr>
<th>max(empdens)</th>
</tr>
</thead>
<tbody>
<tr>
<td>222.649658203125</td>
</tr>
</tbody>
</table>
<p>Notice how traffic zones in the 10000 series have lower maximum employment density than the entire region.</p>
<h4 id="query-example-total-vehicle-kilometers-vkt-by-peak-period-and-origin-gy">Query example: Total vehicle-kilometers (VKT) by peak period and origin GY<a class="headerlink" href="#query-example-total-vehicle-kilometers-vkt-by-peak-period-and-origin-gy" title="Permanent link">&para;</a></h4>
<p>SQL is great at creating pivot tables from large dataset. The <code>sum</code> function computes total of values, and the <code>group by</code> statement define the variable which was used to aggregates the table values.</p>
<pre><code class="language-sql">SELECT gy_i, 
       peak,
       sum(vkt) 

FROM autoVktGy 

GROUP BY gy_i,
         peak
</code></pre>
<p>Sample results of query:</p>
<table>
<thead>
<tr>
<th>gy_i</th>
<th>peak</th>
<th>sum(vkt)</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>am</td>
<td>106675.75589299179</td>
</tr>
<tr>
<td>1</td>
<td>md</td>
<td>65820.09947714038</td>
</tr>
<tr>
<td>1</td>
<td>pm</td>
<td>97089.90104259636</td>
</tr>
<tr>
<td>2</td>
<td>am</td>
<td>229276.9490799977</td>
</tr>
<tr>
<td>2</td>
<td>md</td>
<td>134214.06760361523</td>
</tr>
<tr>
<td>2</td>
<td>pm</td>
<td>212243.29537474972</td>
</tr>
<tr>
<td>3</td>
<td>am</td>
<td>71116.98403721345</td>
</tr>
<tr>
<td>3</td>
<td>md</td>
<td>84972.73319700224</td>
</tr>
<tr>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
</tbody>
</table>
<p><a href="https://www.w3schools.com/sql/">Learn more about SQL</a>.</p>
<!-- Links -->
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../data_analysis/" class="btn btn-neutral float-right" title="Model Data Analysis">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../adv_inputs/" class="btn btn-neutral" title="Advanced Inputs"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
      <p>Copyright &copy; 2020 TransLink Forecasting</p>
    
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/TransLinkForecasting/rtmdoc" class="fa fa-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="../adv_inputs/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../data_analysis/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
