<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <meta name="author" content="TransLink Forecasting">
  <link rel="canonical" href="https://translinkforecasting.github.io/rtmdoc/workflow/">
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>Model Workflow - RTM</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" />

  <link rel="stylesheet" href="../css/theme.css" />
  <link rel="stylesheet" href="../css/theme_extra.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" />
  <link href="../css/extra.css" rel="stylesheet" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "Model Workflow";
    var mkdocs_page_input_path = "workflow.md";
    var mkdocs_page_url = "/rtmdoc/workflow/";
  </script>
  
  <script src="../js/jquery-2.1.1.min.js" defer></script>
  <script src="../js/modernizr-2.8.3.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/yaml.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/rust.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
  <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

      ga('create', '', 'auto');
      ga('send', 'pageview');
  </script>
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> RTM</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <p class="caption"><span class="caption-text">User Guide</span></p>
                <ul class="current">
                    <li class="toctree-l1 current"><a class="reference internal current" href="./">Model Workflow</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#requirements">Requirements</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#cloning-the-model">Cloning the Model</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#update-file-references">Update File References</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#folder-structure">Folder Structure</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#base-networks-folder">Base Networks Folder</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#scripts-folder">Scripts Folder</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#other-folders">Other Folders</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#initialize-databank">Initialize Databank</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#with-emme-modeler">With EMME Modeler</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#with-emme-notebook">With EMME Notebook</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#build-scenario">Build Scenario</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#network-editing">Network editing</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#custom-inputs">Custom Inputs</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#custom-scalars">Custom Scalars</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#custom-network">Custom Network</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#custom-transit-lines">Custom Transit Lines</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#custom-transit-segments">Custom Transit Segments</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#example-2050-brt-line">Example: 2050 BRT Line</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#step-1-add-new-modes">Step 1: add new modes</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#step-2-create-new-scenarios">Step 2: create new scenarios</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#step-3-perform-network-editing">Step 3: perform network editing</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#step-4-set-up-custom-inputs">Step 4: set up custom inputs</a>
    </li>
        </ul>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#export-scenario">Export Scenario</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#export-network">Export Network</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#organize-scenario-inputs">Organize Scenario Inputs</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#run-model">Run Model</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#emme-modeler">EMME Modeler</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#emme-notebook">EMME Notebook</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#commit-changes">Commit Changes</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#push-changes-to-github">Push Changes to GitHub</a>
    </li>
        </ul>
    </li>
    </ul>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../data_outputs/">Model Data Output</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../data_analysis/">Model Data Analysis</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../data_generate/">Custom Data Generation</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Developer Guide</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../dev_getting_started/">Getting Started</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../coding_standard/">Coding Standard</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">References</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../naming_conventions/">Naming Conventions</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../data_assumptions/">Data and Assumptions</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">About</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../about/contributing/">Contributing</a>
                    </li>
                </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">RTM</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
        
          <li>User Guide &raquo;</li>
        
      
    
    <li>Model Workflow</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="model-workflow">Model Workflow<a class="headerlink" href="#model-workflow" title="Permanent link">&para;</a></h1>
<p>In this section, we will show you the best practices when working with the RTM from setting up your environment to extracting model results.</p>
<h2 id="requirements">Requirements<a class="headerlink" href="#requirements" title="Permanent link">&para;</a></h2>
<p>We encourage all users and developers to be familiar with <a href="https://www.inrosoftware.com/en/products/emme/">EMME</a> as well as the RTM development stack: <a href="https://www.learnpython.org/">python</a>, <a href="https://www.w3schools.com/sql/">SQL</a> and <a href="https://git-scm.com/docs">git</a>. If you are new to EMME, we recommend you to take <a href="https://www.inrosoftware.com/en/services/training/">EMME Training Courses</a>. If you are new to programming, you should go through some online tutorials and documentations for <a href="https://www.learnpython.org/">python</a>, <a href="https://www.w3schools.com/sql/">SQL</a> and <a href="https://git-scm.com/docs">git</a> before proceeding. </p>
<ul>
<li>Licensed installation of <a href="https://blog.inrosoftware.com/blog/emme-4.4-release">EMME Desktop 4.4.2</a></li>
<li>Installation of <a href="https://git-scm.com/docs">git</a></li>
<li>Installation of <a href="https://git-lfs.github.com/">git lfs</a></li>
<li>Installation of <a href="https://sqlitestudio.pl/">SQLite Studio</a></li>
<li>Installation of <a href="https://code.visualstudio.com/download">Visual Studio Code</a> (optional)</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>A valid <a href="https://www.inrosoftware.com/en/products/emme/">EMME</a> license is required to run the RTM. See <a href="../about/contributing">Contributing</a> if you need help obtaining a license or need access to the RTM.</p>
</div>
<h2 id="cloning-the-model">Cloning the Model<a class="headerlink" href="#cloning-the-model" title="Permanent link">&para;</a></h2>
<p>To get the latest version of the rtm, clone it from the RTM github repository. The following bash commands will clone the repository from the master branch, and fetch the latest commit with large file storage support. Then, it will checkout the current branch into a new branch named <code>master_working_01</code>. We recommend that you rename the new branch based on the project you are working on:</p>
<pre><code class="language-bash">git clone https://github.com/TransLinkForecasting/rtm.git --branch master --single-branch
cd rtm/
git fetch --all
git lfs install
git lfs pull
git checkout -b 'master_working_01'
</code></pre>
<p>To clone a specific official release, replace <code>master</code> with a version tag such as <code>RTM3.3</code>. If this is the first time you use git, you might need to set your name and email for git commits, see <a href="https://git-scm.com/book/en/v2/Getting-Started-First-Time-Git-Setup">Git Setup</a>.</p>
<h3 id="update-file-references">Update File References<a class="headerlink" href="#update-file-references" title="Permanent link">&para;</a></h3>
<p>EMME toolbox stores absolute paths and they need to be updated when the model has been copied or moved to a new directory. Please also run the following after you clone the model:</p>
<pre><code class="language-bash">cd 'RTM/Scripts/'
bash 'relocate_tools.sh'
</code></pre>
<p>Alternatively, you can run the batch file on Windows:</p>
<pre><code class="language-bash">cd 'RTM/Scripts/'
start 'relocate_tools.bat'
</code></pre>
<h2 id="folder-structure">Folder Structure<a class="headerlink" href="#folder-structure" title="Permanent link">&para;</a></h2>
<p>The RTM is delivered as a collection of input files in the <code>BaseNetworks/</code> folder with a collection of python scripts in <code>Scripts/</code> folder. The EMME project file <code>RTM.emp</code> references all required folders and is loaded with a <code>Minimal Base Databank</code> stored in <code>Template/</code> folder.</p>
<p>Everything stored within the <code>RTM</code> folder is considered project-level, and run specific inputs are stored in the <code>BaseNetworks/</code> folder.</p>
<p>Before running the model, familiarize yourself with the model folder structure. </p>
<pre><code class="language-Markdown">    RTM/
    ├── BaseNetworks/
    │   └── Inputs/
    │
    ├── Documentation/
    ├── Logbook/
    ├── Media/
    ├── Scripts/
    ├── Template/
    ├── Views/
    ├── Worksheets/
    │
    └── RTM.emp
</code></pre>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Do not delete the <code>Minimal Base Databank</code> in EMME or the <code>Template/</code> folder. This is an empty placeholder databank that is packaged with the RTM to enable the initialization of databank through EMME Modeler or EMME Notebook.</p>
</div>
<p></p>

<h3 id="base-networks-folder">Base Networks Folder<a class="headerlink" href="#base-networks-folder" title="Permanent link">&para;</a></h3>
<p>The base network folder contains files required to build a databank from scratch. Each set of files in the main <code>BaseNetworks/</code> supply input data for each scenario year (for example: 2017, 2035, 2050), the set of files can be mainly classified as the following:</p>
<ul>
<li>Network batchin files: <code>base_network_*.txt</code>, <code>link_shape_*.txt</code>, etc</li>
<li>Calibration factors (K-factors): <code>dist_factors_gy.csv.gz</code></li>
<li>External demand, bike scores: <code>externals_bikescore_*.csv.gz</code></li>
<li>Starter Skims: <code>start_skims.csv.gz</code></li>
<li>Fare zones: <code>fare_zones_travelled.csv.gz</code></li>
<li>Definition of ensembles: <code>taz1700_ensembles.csv</code></li>
<li>Definition of modes: <code>modes.in</code></li>
<li>Definition of transit vehicles: <code>tvehicles.in</code></li>
<li>Demographics and geographics of Metro Vancouver: <code>taz1700_demographics_*.csv</code>, <code>taz1700_geographics_*.csv</code></li>
<li>Geographic dummies: <code>taz1700_dummies.csv</code></li>
<li>Park and ride assumptions: <code>taz1700_pnr.csv</code></li>
<li>Time slicing: <code>time_slicing.csv</code>, <code>time_slicing_gb.csv</code></li>
<li>Transit bias calibrations: <code>transit_adj.csv</code></li>
<li>Truck model batch files: <code>TruckBatchFiles/*</code></li>
</ul>
<pre><code class="language-Markdown">    RTM/
    ├── BaseNetworks/
    │   ├── base_network_*.txt
    │   ├── link_shape_*.txt
    │   ├── turns_*.txt
    │   ├── transit_lines_*.txt
    │   ├── extra_nodes_*.txt
    │   ├── extra_links_*.txt
    │   ├── extra_turns_*.txt
    │   ├── extra_transit_lines_*.txt
    │   ├── dist_factors_gy.csv.gz
    │   ├── externals_bikescore_*.csv.gz
    │   ├── fare_zones_travelled.csv.gz
    │   ├── start_skims.csv.gz
    │   ├── taz1700_ensembles.csv
    │   ├── modes.in
    │   ├── tvehicles.in
    │   │
    │   └── Inputs/
    │         ├── taz1700_demographics_*.csv
    │         ├── taz1700_geographics_*.csv
    │         ├── taz1700_dummies.csv
    │         ├── taz1700_pnr.csv
    │         ├── time_slicing.csv
    │         ├── time_slicing_gb.csv
    │         ├── transit_adj.csv
    │         └── TruckBatchFiles/
    │               ├── *AsiaPacificv1.txt
    │               ├── *CrossBorderv1.txt
    │               ├── IRBatchIn.txt
    │               ├── PMVActivity.txt
    │               └── RGBatchIn.txt
    └── ...
</code></pre>
<p></p>

<h3 id="scripts-folder">Scripts Folder<a class="headerlink" href="#scripts-folder" title="Permanent link">&para;</a></h3>
<p>This folder contains python scripts used to run the model:</p>
<ul>
<li>Toolbox relocate tool: <code>relocate_tools.bat</code>, <code>relocate_tools.sh</code>, <code>toolbox_modify.py</code></li>
<li>Model Scripts toolbox: <code>Phase3Scripts/</code></li>
<li>Model utility toolbox: <code>util/</code></li>
<li>Model tools, scripts and notebooks of model initialization and model runs: <code>Notebooks/</code></li>
<li>Analytics toolbox: <code>Phase3Analytics/</code></li>
<li>Tools toolbox: <code>Phase3Tools/</code></li>
</ul>
<pre><code class="language-Markdown">    RTM/
    ├── Scripts/
    │   ├── relocate_tools.bat
    │   ├── relocate_tools.sh
    │   ├── toolbox_modify.py
    │   │
    │   ├── Notebooks/
    │   ├── Phase3Scripts/
    │   ├── util/
    │   ├── Phase3Analytics/
    │   └── Phase3Tools/
    └── ...
</code></pre>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The Scripts control the model behavior of the RTM. You are free to go through the script to familiarize with the implementation of the model. For more information regarding the modeling structure of the RTM, modeling decisions, data sources, estimation of sub models, please <a href="../about/contributing">contact us</a>.</p>
</div>
<p></p>

<h3 id="other-folders">Other Folders<a class="headerlink" href="#other-folders" title="Permanent link">&para;</a></h3>
<ul>
<li><code>Media</code> folder Contains shapefiles, ArcGIS maps. Output data are typically stored here.</li>
<li><code>Documentation</code> folder contains printable user manuals. </li>
<li><code>Logbook</code> folder contains EMME logbook information generated by EMME Modeler tools. </li>
<li><code>Template</code> folder provides an empty databank that allow Modeler to initialize new RTM databanks. </li>
<li><code>View</code> folder contains standard views provided in the EMME environment.</li>
<li><code>Worksheets</code> folder contains standardized worksheets in the EMME environment.</li>
</ul>
<pre><code class="language-Markdown">    RTM/
    ├── Media/
    ├── Documentation/
    ├── Logbook/
    ├── Template/
    ├── Views/
    ├── Worksheets/
    └── ...
</code></pre>
<h2 id="initialize-databank">Initialize Databank<a class="headerlink" href="#initialize-databank" title="Permanent link">&para;</a></h2>
<p>You can initialize a single databank using the EMME Modeler or initialize multiple databanks using EMME Notebook, depending on your need.</p>
<p>To start the EMME, open the <img alt="Icon" src="../img/RTM_emp_icon.png" /> file. This will launch EMME, open the Minimal Base Databank's Placeholder Scenario when prompted.</p>
<h3 id="with-emme-modeler">With EMME Modeler<a class="headerlink" href="#with-emme-modeler" title="Permanent link">&para;</a></h3>
<ol>
<li>
<p>To open Modeler, click on the EMME Modeler icon <img alt="Icon" src="../img/emme_modeler_icon.png" />.</p>
</li>
<li>
<p>Once the Modeler opens, find Translink RTM Phase 3 Model toolbox and open the <code>Initialize Emmebank</code> tool:</p>
<blockquote>
<p><img alt="Screenshot" src="../img/workflow/initialize_emme_1.png" /></p>
</blockquote>
</li>
<li>
<p>Enter a folder name and a name for the databank. Try to be descriptive. For example, if this is a databank for editing or debugging network only, name it <code>network_edit_something</code>, if this is a final copy of a new business as usual run for year 2050, name it <code>00_BAU_2050</code>. Once you enter the names, click <strong>&gt; Run</strong>. </p>
<blockquote>
<p><img alt="Screenshot" src="../img/workflow/initialize_emme_2.png" /></p>
</blockquote>
</li>
</ol>
<p>Once the run is completed, the <strong>Tool complete</strong> message will appear.</p>
<blockquote>
<p><img alt="Screenshot" src="../img/workflow/initialize_emme_3.png" /></p>
</blockquote>
<h3 id="with-emme-notebook">With EMME Notebook<a class="headerlink" href="#with-emme-notebook" title="Permanent link">&para;</a></h3>
<p>If you are comfortable with python and Jupyter Notebook, we strongly recommend that you use EMME Notebook to initialize databanks. This improves the reproducibility of your model run. This is generally not needed for network scenario or testing, but for final copy of a run, it is highly recommend.</p>
<p>The <code>init_many.ipynb</code> notebook contains a template for initialize many databanks.</p>
<ol>
<li>
<p>To open EMME Notebook, click on the EMME Notebook icon <img alt="Icon" src="../img/emme_notebook_icon.png" />.</p>
</li>
<li>
<p>The EMME Notebook should open in your browser, if it didn't open automatically, look for <code>http://localhost:xxxx/</code> in the EMME - Notebook command prompt window. The default is usually <code>http://localhost:8888/</code>.</p>
<blockquote>
<p><img alt="Screenshot" src="../img/workflow/initialize_emme_nb_1.png" /></p>
</blockquote>
</li>
<li>
<p>Once opened, you should see a list of folders in the <code>Scripts/</code> folder. Go to <code>Tools/</code> folder and make a duplicate of <code>init_many.ipynb</code>, name it to something more descriptive for your use, like <code>init_many_00_BAU_2050.ipynb</code>, then open it.</p>
<blockquote>
<p><img alt="Screenshot" src="../img/workflow/initialize_emme_nb_2_1.png" /></p>
<p><img alt="Screenshot" src="../img/workflow/initialize_emme_nb_2_2.png" /></p>
</blockquote>
</li>
<li>
<p>Modify params as needed, run the entire script to initialize the databank.</p>
<blockquote>
<p><img alt="Screenshot" src="../img/workflow/initialize_emme_nb_3_1.png" /></p>
<p><img alt="Screenshot" src="../img/workflow/initialize_emme_nb_3_2.png" /></p>
</blockquote>
</li>
</ol>
<h2 id="build-scenario">Build Scenario<a class="headerlink" href="#build-scenario" title="Permanent link">&para;</a></h2>
<p>There are a wide range of changes you can make to the EMME base model for your study. We won't be able to cover them all in detail here, but here are some examples of model changes:</p>
<ul>
<li>demographics</li>
<li>new roads or bridges</li>
<li>new transit lines</li>
<li>new transit stops</li>
<li>transit fare</li>
<li>tolls</li>
<li>mobility pricing</li>
<li>park and ride pricing</li>
<li>etc...</li>
</ul>
<!-- TODO: add specific best practice guide for each type of model changes -->

<h3 id="network-editing">Network editing<a class="headerlink" href="#network-editing" title="Permanent link">&para;</a></h3>
<p>The EMME Network Editor provides users the ability to create and modify nodes, links, turns, transit lines, and transit segments. We will use a BRT line example to illustrate how to add modes and vehicles for the RTM, and edit networks in EMME.</p>
<h3 id="custom-inputs">Custom Inputs<a class="headerlink" href="#custom-inputs" title="Permanent link">&para;</a></h3>
<p>There are a number of custom inputs that the RTM uses at model initialization and run time to modify model behavior:</p>
<ul>
<li>At initiation<ul>
<li>Transit vehicles and modes</li>
</ul>
</li>
<li>At runtime<ul>
<li>Required files with model data<ul>
<li>demographic and geographic</li>
</ul>
</li>
<li>Optional files to manipulate model data<ul>
<li>Scalars: <code>custom_scalars.csv</code></li>
<li>Network: <code>custom_network.txt</code></li>
<li>Transit Lines: <code>custom_tline.txt</code></li>
<li>Transit Segment: <code>custom_tseg.txt</code></li>
</ul>
</li>
</ul>
</li>
</ul>
<p>The optional <code>custom_&lt;datatype&gt;</code> series files can be placed in the <code>RTM/&lt;your run directory&gt;/inputs</code> folder of the RTM instance.  These files are imported after the main model setup (<code>create scenarios</code> and <code>data import</code>) and can be used to change any model setting held in a scalar matrix or execute an arbitrary set of network link, transit line, or transit segment calculations.  Files with a <code>.csv</code> extension indicate comma delimited data while files with a <code>.txt</code> extension indicate tab delimited data.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Do not leave a trailing new line or carriage return at the end of the files <code>custom_&lt;datatype&gt;.txt</code> files.  In addition, there can be only one file of each name in the inputs folder.  </p>
</div>
<h4 id="custom-scalars">Custom Scalars<a class="headerlink" href="#custom-scalars" title="Permanent link">&para;</a></h4>
<p>This file allow the user to change data held in scalar matrices in the scripting without changing the scripting.  This in turn allows the user to run multiple runs with the same scripts and different scalar matrix data.  </p>
<p>The <code>custom_scalars.csv</code> file has headers and requires the following information in comma delimited format.</p>
<table>
<thead>
<tr>
<th>Matrix ID</th>
<th>Matrix Name</th>
<th>Matrix Description</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>The EMME Matrix ID number</td>
<td>The EMME Matrix Name</td>
<td>The EMME Matrix Description</td>
<td>The value to change</td>
</tr>
</tbody>
</table>
<p>Below is an example of changing the auto operating cost using the custom scalars file.</p>
<p><img alt="Screenshot" src="../img/workflow/custom_inputs_custom_scalars.png" /></p>
<h4 id="custom-network">Custom Network<a class="headerlink" href="#custom-network" title="Permanent link">&para;</a></h4>
<p>This file allows the user to execute an arbitrary set of network link calculations prior to running the model.  </p>
<p>The <code>custom_network.txt</code> file should not have headers and requires the following information in tab delimited format</p>
<table>
<thead>
<tr>
<th>Period</th>
<th>Result</th>
<th>Expression</th>
<th>Selection</th>
<th>Aggregation</th>
</tr>
</thead>
<tbody>
<tr>
<td>AM, MD, PM, or ALL</td>
<td>Where the calculation should be stored (for instance @capacity)</td>
<td>The network calculation to be executed</td>
<td>Which link(s) to execute the calculation on (optional - can be left blank to update all links)</td>
<td>Results aggregation (optional and generally left blank)</td>
</tr>
</tbody>
</table>
<p>Below is an example of removing one lane and reducing capacity on links 111902-111904 and 111904-111902, and setting the signal delay to 0 for all links that are not VDF 14 for all three assignment periods.  Note that there is no carriage return on the last line.  </p>
<p><img alt="Screenshot" src="../img/workflow/custom_inputs_custom_network.png" /></p>
<h4 id="custom-transit-lines">Custom Transit Lines<a class="headerlink" href="#custom-transit-lines" title="Permanent link">&para;</a></h4>
<p>This file allows the user to execute an arbitrary set of network transit line calculations prior to running the model.  </p>
<p>The <code>custom_tline.txt</code> file should not have headers and requires the following information in tab delimited format</p>
<table>
<thead>
<tr>
<th>Period</th>
<th>Result</th>
<th>Expression</th>
<th>Selection</th>
<th>Aggregation</th>
</tr>
</thead>
<tbody>
<tr>
<td>AM, MD, PM, or ALL</td>
<td>Where the calculation should be stored (for instance hdw)</td>
<td>The network calculation to be executed</td>
<td>Which line(s) to execute the calculation on (optional - can be left blank to update all lines)</td>
<td>Results aggregation (optional and generally left blank)</td>
</tr>
</tbody>
</table>
<p>Below is an example of reducing the headway on all lines except those in the Fraser Valley during the AM and PM peak hours, and setting the signal delay to 0 for all links that are not VDF 14 for all three assignment periods.  Note that there is no carriage return on the last line.  </p>
<p><img alt="Screenshot" src="../img/workflow/custom_inputs_custom_tline.png" /></p>
<h4 id="custom-transit-segments">Custom Transit Segments<a class="headerlink" href="#custom-transit-segments" title="Permanent link">&para;</a></h4>
<p>This file allows the user to execute an arbitrary set of network transit segment calculations prior to running the model.  </p>
<p>The <code>custom_tseg.txt</code> file should not have headers and requires the following information in tab delimited format</p>
<table>
<thead>
<tr>
<th>Period</th>
<th>Result</th>
<th>Expression</th>
<th>Selection</th>
<th>Aggregation</th>
</tr>
</thead>
<tbody>
<tr>
<td>AM, MD, PM, or ALL</td>
<td>Where the calculation should be stored (for instance ttf)</td>
<td>The network calculation to be executed</td>
<td>Which line(s) to execute the calculation on (optional - can be left blank to update all lines)</td>
<td>Results aggregation (optional and generally left blank)</td>
</tr>
</tbody>
</table>
<p>Below is an example of changing the transit time function (ttf) on links 111902-111904 and 111904-111902 to ttf2.  Note that there is no carriage return on the last line.  </p>
<p><img alt="Screenshot" src="../img/workflow/custom_inputs_custom_tseg.png" /></p>
<h3 id="example-2050-brt-line">Example: 2050 BRT Line<a class="headerlink" href="#example-2050-brt-line" title="Permanent link">&para;</a></h3>
<p>Similar to most model application exercises, in our example, there are two main components of changes we are making to the 2050 base model: network editing and model custom inputs.</p>
<ul>
<li>Network editing - adding a new transit line</li>
<li>Custom inputs<ul>
<li>Add congestion pricing to the network with <code>custom_network.txt</code> input file</li>
<li>Use a custom demographic file for corridor intensification</li>
</ul>
</li>
</ul>
<h4 id="step-1-add-new-modes">Step 1: add new modes<a class="headerlink" href="#step-1-add-new-modes" title="Permanent link">&para;</a></h4>
<p>Before we create a new transit line, we need to make sure the mode and the vehicle of is available, add the new mode to <code>modes.in</code> file in the base network folder:</p>
<blockquote>
<p><img alt="Screenshot" src="../img/workflow/network_edit_brt_1_4.png" /></p>
</blockquote>
<p>Then check the <code>tvehicles.in</code> file in the base network folder:</p>
<blockquote>
<p><img alt="Screenshot" src="../img/workflow/network_edit_brt_2.png" /></p>
</blockquote>
<p>After new modes or vehicles are added, it won't be available in the already initialized databank and scenario. You should re-initialize a working copy of the databank.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Choosing the BRT and LRT vehicle in <code>tvehicles.in</code> with <code>modes.in</code> implements the unobserved mode discussed in the October 2019 User Group Meeting. <a href="https://github.com/TransLinkForecasting/rtm-workshops/blob/master/2019-Oct/5.Modeling_Non-existing_Modes.pdf">Presentation available here</a>.</p>
</div>
<h4 id="step-2-create-new-scenarios">Step 2: create new scenarios<a class="headerlink" href="#step-2-create-new-scenarios" title="Permanent link">&para;</a></h4>
<p>Duplicate the base scenario input files, and rename them with a new scenario number. For example, if you are making changes on top of scenario "5000", name it "5001", "5002".</p>
<blockquote>
<p><img alt="Screenshot" src="../img/workflow/network_edit_brt_1_1.png" /></p>
<p><img alt="Screenshot" src="../img/workflow/network_edit_brt_1_2.png" /></p>
</blockquote>
<h5 id="load-new-scenario-manually">Load new scenario manually<a class="headerlink" href="#load-new-scenario-manually" title="Permanent link">&para;</a></h5>
<p>To load new scenario into your current data bank, open Modeler and Import Network Tool:</p>
<blockquote>
<p><img alt="Screenshot" src="../img/workflow/network_edit_brt_1_2_1.png" /></p>
</blockquote>
<p>Enter the scenario number and a title for it, click run to load the scenario.</p>
<blockquote>
<p><img alt="Screenshot" src="../img/workflow/network_edit_brt_1_2_2.png" /></p>
</blockquote>
<p>It now should be available in the list of scenario and you can set it as your active scenario to perform your network changes.</p>
<blockquote>
<p><img alt="Screenshot" src="../img/workflow/network_edit_brt_1_2_3.png" /></p>
</blockquote>
<h5 id="optional-always-load-new-scenario-on-databank-initialization">Optional: Always load new scenario on databank initialization<a class="headerlink" href="#optional-always-load-new-scenario-on-databank-initialization" title="Permanent link">&para;</a></h5>
<p>If you want the newly created scenario to be imported every time you initialize a new emmebank, modify <code>InitEmmebank.py</code>. Once you set up the scenarios, add these new scenario numbers into the <code>InitEmmebank.py</code> script. This will allow the initialize emmebank modeler tool to load the new scenarios.</p>
<blockquote>
<p><img alt="Screenshot" src="../img/workflow/network_edit_brt_1_3.png" /></p>
</blockquote>
<p>Now, you can initialize a new databank and your new scenario will be loaded by default. You can give it a descriptive and abbreviated name such as <code>01_Lg_BRT_CP_LU_2050</code>.</p>
<h4 id="step-3-perform-network-editing">Step 3: perform network editing<a class="headerlink" href="#step-3-perform-network-editing" title="Permanent link">&para;</a></h4>
<p>Open EMME network editor <img alt="Icon" src="../img/emme_networkeditor_icon.png" />, add notes, links, and transit line as needed. Make sure you save a copy of the build file before you save and exit the scenario. <strong>Build files can be created from any changes you made while in the Network Editor.</strong> The build file is a great way to save and replicate model network changes. If you have a build file, you can stage it and run the changes.</p>
<ul>
<li>Copy your build file to <code>Network_builds/</code> folder.</li>
<li>Open "Network History and Builds" prompt from EMME Network Editor <img alt="Icon" src="../img/emme_networkeditorbuild_icon.png" />. Click the folder icon to "Add network builds", then click "Stage".</li>
<li>Preview the build, then run the build:</li>
</ul>
<blockquote>
<p><img alt="Screenshot" src="../img/workflow/network_edit_brt_3.png" /></p>
</blockquote>
<h4 id="step-4-set-up-custom-inputs">Step 4: set up custom inputs<a class="headerlink" href="#step-4-set-up-custom-inputs" title="Permanent link">&para;</a></h4>
<p>For the BRT example, we will use <code>custom_network.txt</code> and a simple 8-zone shapefile to add congestion pricing attribute to the network in batch. We will also load a custom demographic file with 20% population intensification along the study corridor.</p>
<ul>
<li>
<p>Custom inputs often require link tagging defined by the intersection of input polygons and network links in EMME. This can be done in Modeler or Notebook using the Geographic Tagging Tool:</p>
<blockquote>
<p><img alt="Screenshot" src="../img/workflow/network_edit_brt_4_1_1.png" />
<img alt="Screenshot" src="../img/workflow/network_edit_brt_4_1_2.png" /></p>
</blockquote>
</li>
<li>
<p>After link tagging, the custom input file such as <code>custom_network.txt</code> needs to be placed in the <code>Input/</code> folder within the emme databank folder, such as the folder <code>db_01_Lg_BRT_CP_LU_2050</code> or <code>01_Lg_BRT_CP_LU_2050</code>. (Do not place the file in the BaseNetworks folder!)</p>
<blockquote>
<p><img alt="Screenshot" src="../img/workflow/network_edit_brt_4_1_3.png" /></p>
</blockquote>
</li>
</ul>
<p>Read more about <a href="../workflow/#custom-network">Custom Networks</a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Read more on link tagging tool in: <code>RTM\Documentation\ToolDoc_GeographicTagging.pdf</code>.</p>
</div>
<ul>
<li>The custom demographic file such as <code>taz1700_demographics_2050-20.csv</code> needs to be selected as the demographic input when running the model.<blockquote>
<p><img alt="Screenshot" src="../img/workflow/network_edit_brt_4_2.png" /></p>
</blockquote>
</li>
</ul>
<h2 id="export-scenario">Export Scenario<a class="headerlink" href="#export-scenario" title="Permanent link">&para;</a></h2>
<p>While in most cases your current databank for the alternative scenario is ready to run, it is important to export your new scenario network and organize all input files into a sub folder within the <code>Scenario_Inputs</code> folder. This allows you to share your new scenario with other users without needing to copy the entire databank with results. This also allow you to quickly reinitialize the scenario to run on a newer version of the RTM.</p>
<h3 id="export-network">Export Network<a class="headerlink" href="#export-network" title="Permanent link">&para;</a></h3>
<p>To export your scenario's network, open EMME Modeler:</p>
<blockquote>
<p><img alt="Screenshot" src="../img/workflow/network_export_brt_1.png" /></p>
</blockquote>
<p>Then select your new scenario to export:</p>
<blockquote>
<p><img alt="Screenshot" src="../img/workflow/network_export_brt_2.png" /></p>
</blockquote>
<h3 id="organize-scenario-inputs">Organize Scenario Inputs<a class="headerlink" href="#organize-scenario-inputs" title="Permanent link">&para;</a></h3>
<p>We highly recommend that you store every input required to rebuild your new scenario and replicate your model run within a sub folder of the <code>Scenario_Inputs</code> folder. For our example, this would be the folder structure for all the changes we have made in our BRT example:</p>
<pre><code class="language-Markdown">    RTM/
    ├── Scenario_Inputs/
    │   └── 01_2050-20-hw8-cp_Lg_BRT-g/
    │         ├── custom_network.txt
    │         ├── modes.in
    │         ├── tvehicles.in
    │         │
    │         ├── BaseNetworks/
    │         │      ├── Inputs/
    │         │      │       └── taz1700_demographics_2050-20.csv
    │         │      ├── base_network_5001.txt
    │         │      └── ...
    │         ├── Scripts/Phase3Scripts/
    │         │      ├── Tools/
    │         │      │       │── init_many_example_lgrt.ipynb
    │         │      │       └── run_many_example_lgrt.ipynb
    │         │      └── Phase3Scripts/
    │         │             └── InitEmmebank.py
    │         └── Media/
    │               └── RTM_8ZonePolygon.shp
    └── ...
</code></pre>
<h2 id="run-model">Run Model<a class="headerlink" href="#run-model" title="Permanent link">&para;</a></h2>
<p>You can run the model using a single databank using the EMME Modeler or run multiple databanks using the EMME Notebook, depending on your need. </p>
<h3 id="emme-modeler">EMME Modeler<a class="headerlink" href="#emme-modeler" title="Permanent link">&para;</a></h3>
<p>Once you have set up all the input files in the databank, such as customized demographics, custom input files, etc, you are ready to do a full model run using the EMME Modeler.</p>
<ol>
<li>
<p>To open Modeler, click on the EMME Modeler icon <img alt="Icon" src="../img/emme_modeler_icon.png" />.</p>
</li>
<li>
<p>Find Translink RTM Phase 3 Model toolbox and open the <code>Run RTM3</code> tool:</p>
<blockquote>
<p><img alt="Screenshot" src="../img/workflow/run_model_1_1.png" /></p>
</blockquote>
</li>
<li>
<p>Change the Full Model Run settings as needed. Make sure to enter the correct model horizon year, scenario, demographic and geographic inputs.</p>
<blockquote>
<p><img alt="Screenshot" src="../img/workflow/run_model_1_2.png" /></p>
<p><img alt="Screenshot" src="../img/workflow/run_model_1_3.png" /></p>
</blockquote>
</li>
<li>
<p>Click <code>Run</code>. Each model run can take 2 to 4 hours depending on the custom settings and scenario.</p>
</li>
</ol>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Do not interrupt the model run. The RTM model is not designed to be run in separate stages or run multiple times. If you stopped a model run before it is done, you should start over and run the model again.</p>
</div>
<h3 id="emme-notebook">EMME Notebook<a class="headerlink" href="#emme-notebook" title="Permanent link">&para;</a></h3>
<p>The <code>run_many.ipynb</code> notebook contains a template for running many model runs. It handles multiple model runs and runs with complex set up. It is ideal for our BRT example where we needed to perform link tagging and use custom network input file for congestion pricing. Note sometimes additional coding is required to call toolboxes that are relevant to the particular model run.</p>
<ol>
<li>
<p>To open EMME Notebook, click on the EMME Notebook icon <img alt="Icon" src="../img/emme_notebook_icon.png" />.</p>
</li>
<li>
<p>The EMME Notebook should open in your browser, if it didn't open automatically, look for <code>http://localhost:xxxx/</code> in the EMME - Notebook command prompt window. The default is usually <code>http://localhost:8888/</code>.</p>
<blockquote>
<p><img alt="Screenshot" src="../img/workflow/initialize_emme_nb_1.png" /></p>
</blockquote>
</li>
<li>
<p>Once opened, you should see a list of folders in the <code>Scripts/</code> folder. Go to <code>Tools/</code> folder and make a duplicate of <code>run_many.ipynb</code>, name it to something more descriptive for your use, like <code>run_many_00_BAU_2050.ipynb</code> or <code>run_many_example_lgrt.ipynb</code>, then open it.</p>
<blockquote>
<p><img alt="Screenshot" src="../img/workflow/run_model_nb_1.png" /></p>
</blockquote>
</li>
<li>
<p>Modify params as needed.</p>
<blockquote>
<p><img alt="Screenshot" src="../img/workflow/run_model_nb_2_1.png" /></p>
</blockquote>
</li>
<li>
<p>Make sure you carefully review the script associated with the model run. You may need to add new code to this section depending on the requirements of your model run.</p>
<blockquote>
<p><img alt="Screenshot" src="../img/workflow/run_model_nb_2_2.png" /></p>
</blockquote>
</li>
<li>
<p>Run the entire script to perform the full model run with custom settings.</p>
<blockquote>
<p><img alt="Screenshot" src="../img/workflow/run_model_nb_3.png" /></p>
</blockquote>
</li>
</ol>
<h2 id="commit-changes">Commit Changes<a class="headerlink" href="#commit-changes" title="Permanent link">&para;</a></h2>
<p>If this is your first time using <a href="https://git-scm.com/docs">git</a> after an installation, see <a href="https://git-scm.com/book/en/v2/Getting-Started-First-Time-Git-Setup">Git Setup</a>.</p>
<p>While working with the RTM on git, here are some ground rules:</p>
<ul>
<li>Main project branches (<em>master</em>, <em>example_brt_proj</em>) are always protected. Push a temp branch then do pull request to merge your changes</li>
<li>Only stage and commit model inputs and settings, never databanks</li>
<li>Any scenario-specific changes for scripts should be placed into <code>Scenario_Inputs</code> for commit</li>
<li>Organize a <code>Scenario_Inputs</code> folder when you finish a scenario</li>
<li>Use active verb for commit messages, like "add scenario inputs for brt examples."</li>
</ul>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Do not commit the databank associated with the model run. We recommend you to place the databank folders in your version of the <code>.gitignore</code>.</p>
<p>When staging and committing model changes, think about what other users or developers may need to run your scenario from scratch. <strong>Commit inputs and set up, not the results.</strong></p>
</div>
<h3 id="push-changes-to-github">Push Changes to GitHub<a class="headerlink" href="#push-changes-to-github" title="Permanent link">&para;</a></h3>
<p>If you are a collaborator, you may push your changes to the rtm repository on GitHub. You will not be able to push directly to most of the branches already on the rtm repository as they are protected, so always push your working branch and merge to any main branch with a pull request. An admin will review your changes when you submit a pull request.</p>
<pre><code class="language-bash">git push origin master_your-project
</code></pre>
<p>Learn more about <a href="https://git-scm.com/docs">git</a> and read more about <a href="https://help.github.com/en/github/collaborating-with-issues-and-pull-requests/creating-a-pull-request">GitHub pull request</a>.</p>
<!-- Links -->
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../data_outputs/" class="btn btn-neutral float-right" title="Model Data Output">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
      <p>Copyright &copy; 2020 TransLink Forecasting</p>
    
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/TransLinkForecasting/rtmdoc" class="fa fa-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
      
        <span style="margin-left: 15px"><a href="../data_outputs/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
